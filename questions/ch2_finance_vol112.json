[
  {
    "id": "Q2-FIN-V112-01",
    "chapter": "第2章",
    "level": "K4",
    "category": "金融",
    "style": "シナリオ",
    "type": "単一選択",
    "question": "【分析】同時実行制御（排他制御）のテスト。\n銀行口座の残高更新処理において、「複数のATMから同時に引き出し操作が行われた」場合の整合性を検証したい。\nデータベースの「レースコンディション（競合）」を防ぐための適切なロック機構の検証方法はどれか。",
    "options": [
      "2つのトランザクションがほぼ同時に開始され、片方が参照してから更新するまでの間に、もう片方が割り込んで更新を完了させるシナリオを作成し、「悲観的ロック（SELECT FOR UPDATE）」等により後続処理が待機（ブロック）されることを確認する",
      "トランザクションを直列（順番）に実行し、Aさんが引き出した後にBさんが引き出すという正常系シナリオだけを確認する",
      "「楽観的ロック（バージョンカラム使用）」を採用しているシステムにおいて、競合発生時に後続のトランザクションが強制的に上書き保存し、データ不整合が起きないことを確認する",
      "データベースの分離レベル（Isolation Level）を「Read Uncommitted」に設定し、コミット前のデータが読み取れる状態でテストを行う"
    ],
    "answer": [
      "2つのトランザクションがほぼ同時に開始され、片方が参照してから更新するまでの間に、もう片方が割り込んで更新を完了させるシナリオを作成し、「悲観的ロック（SELECT FOR UPDATE）」等により後続処理が待機（ブロック）されることを確認する"
    ],
    "explanation": "【解説】\n残高更新の競合テストでは、意図的にタイミングを重ねて「ロック待ち（Wait）」または「リトライエラー」が発生し、データの整合性（ACID）が守られるかを確認する必要があります。",
    "tags": [
      "第2章",
      "金融",
      "シナリオ",
      "K4"
    ]
  }
]