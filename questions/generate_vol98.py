import json
import os

# 保存先ディレクトリ
OUTPUT_DIR = "."

# ==========================================
# Vol.98 新規問題データ定義
# ==========================================

# 1. 第2章 一般 (ch2_general_vol98.json)
q2_gen = [
    {
        "id": "Q2-GEN-V98-01",
        "chapter": "第2章",
        "level": "K3",
        "category": "一般",
        "style": "シナリオ",
        "type": "単一選択",
        "question": "【適用】テストデータの匿名化（マスキング）。\n本番環境のデータベースからテスト環境へデータを移行して使用したい。GDPR等の個人情報保護規制を遵守しつつ、テストの有効性（不具合検出能力）を維持するための最適なデータ加工方針はどれか。",
        "options": [
            "個人情報を含むカラム（氏名、電話番号等）をすべて「NULL」または空文字に置換し、個人を特定できないように完全に無効化する（データの整合性や入力チェックのテストができなくなるリスク）",
            "本番データを使用するのはリスクが高すぎるため、本番データの統計情報（分布や件数）のみを参考にして、テストデータ生成ツールで完全に架空の合成データを作成する（本番特有の「汚いデータ」によるバグを見逃すリスク）",
            "氏名や住所をランダムな文字列（例: 'XyZ123'）に置換するが、郵便番号と住所の整合性などは無視して、とにかく個人情報が見えないようにすることだけを優先する（ロジックテストの阻害）",
            "氏名や住所を「擬似データ（仮名、実在しない住所）」に置換しつつ、郵便番号と住所の対応関係や、電話番号の桁数・形式などの「データの特性・参照整合性」は維持する（匿名化とテスト品質の両立）"
        ],
        "answer": [
            "氏名や住所を「擬似データ（仮名、実在しない住所）」に置換しつつ、郵便番号と住所の対応関係や、電話番号の桁数・形式などの「データの特性・参照整合性」は維持する（匿名化とテスト品質の両立）"
        ],
        "explanation": "【解説】\n単に消去（NULL化）するとアプリが動かなくなります。テストデータ管理では「個人情報の秘匿」と「データのリアリティ（特性維持）」のバランスが重要です。",
        "tags": ["第2章", "一般", "シナリオ", "K3"]
    },
    {
        "id": "Q2-GEN-V98-02",
        "chapter": "第2章",
        "level": "K4",
        "category": "一般",
        "style": "シナリオ",
        "type": "単一選択",
        "question": "【分析】回帰テスト自動化のスコープ決定。\n現在、すべての手動テストケース（1000件）を自動化しようとしてプロジェクトが遅延している。\n「投資対効果（ROI）」と「保守性」の観点から、自動化対象として優先すべきテストケースの選定基準として最も適切なものはどれか。",
        "options": [
            "一度しか実行しないが、手順が非常に複雑で手動で行うとミスが発生しやすい「ワンショットの移行テスト」や「データ変換テスト」を優先して自動化する（再利用性が低くROIが悪い）",
            "画面のデザインやレイアウトの微調整を確認するテストなど、目視での確認が重要で、かつ仕様変更が頻繁に発生するUIテストを優先して自動化する（保守コストが高く壊れやすい）",
            "スモークテストや主要なパス（ハッピーパス）など、ビルドごとに毎回実行され、かつ仕様が比較的安定している（変更頻度が低い）テストケースを優先して自動化する",
            "まだ仕様が確定しておらず、開発中の機能に対する探索的テストの一部を、開発と並行してスクリプト化していく（手戻りが多く非効率）"
        ],
        "answer": [
            "スモークテストや主要なパス（ハッピーパス）など、ビルドごとに毎回実行され、かつ仕様が比較的安定している（変更頻度が低い）テストケースを優先して自動化する"
        ],
        "explanation": "【解説】\n自動化の鉄則は「繰り返し実行される」「仕様が安定している」箇所の自動化です。UIやワンショットのテストは後回し（または手動のまま）にすべきです。",
        "tags": ["第2章", "一般", "シナリオ", "K4"]
    }
]

# 2. 第3章 一般 (ch3_general_vol98.json)
q3_gen = [
    {
        "id": "Q3-GEN-V98-01",
        "chapter": "第3章",
        "level": "K3",
        "category": "一般",
        "style": "シナリオ",
        "type": "単一選択",
        "question": "【適用】欠陥トリアージ会議（Defect Triage Meeting）。\nリリース直前の会議で、修正すべきバグが多すぎて開発リソースが足りないことが判明した。\nテストマネージャとして、修正対象を選別するための提案として最も適切なものはどれか。",
        "options": [
            "開発者が「修正しやすい（簡単な）」バグから順に片っ端から修正し、修正数のカウントを稼ぐことで、見た目の進捗率を上げる（品質リスクの無視）",
            "重要度（Severity）だけでなく、発生頻度やビジネス影響度、回避策の有無を考慮して優先度（Priority）を再定義し、優先度「高」のものだけを修正して残りは既知の不具合としてリリースノートに記載する",
            "リリース日を延期することは絶対に許されないため、テストチーム全員でバグ修正を手伝い、何とかして全てのバグを修正する（役割分担の崩壊と新たなバグ混入リスク）",
            "顧客にはバグがないと虚偽の報告をし、リリース後にこっそり修正パッチを当てることで、納期の遅れと品質問題を隠蔽する（コンプライアンス違反）"
        ],
        "answer": [
            "重要度（Severity）だけでなく、発生頻度やビジネス影響度、回避策の有無を考慮して優先度（Priority）を再定義し、優先度「高」のものだけを修正して残りは既知の不具合としてリリースノートに記載する"
        ],
        "explanation": "【解説】\nリソース不足時は「トリアージ（選別）」が必須です。全て直す精神論や、簡単なものから直す現実逃避ではなく、ビジネスリスクに基づいた優先順位付けが正解です。",
        "tags": ["第3章", "一般", "シナリオ", "K3"]
    }
]

# 3. 第1章 AWS (ch1_aws_vol98.json)
q1_aws = [
    {
        "id": "Q1-AWS-V98-01",
        "chapter": "第1章",
        "level": "K3",
        "category": "AWS",
        "style": "シナリオ",
        "type": "単一選択",
        "question": "【適用】S3のライフサイクルポリシー検証。\n「作成から30日経過したログファイルを、安価なS3 Glacierクラスへ自動移行する」という設定を行った。\nこの設定が正しく動作するかを検証するための、最も効率的かつ現実的なテスト方法はどれか。",
        "options": [
            "実際にファイルを作成してから30日間待ち続け、30日後にクラスが変更されているかを確認する（テスト期間が長すぎて現実的ではない）",
            "S3のライフサイクルルール設定において、移行対象の日数を一時的に「0日（または1日）」に変更し、ファイル作成の翌日（または直後）にクラス移行が行われることを確認する",
            "サーバーの日付設定を30日後に変更して無理やり未来の状態を作り出し、S3側が騙されて移行処理を行うか試す（S3はAWS管理の時刻で動くため無意味）",
            "ライフサイクルポリシーのJSONファイルを目視で確認し、記述ミスがないことだけをチェックして、動作検証は省略する（設定ミスや適用漏れのリスク）"
        ],
        "answer": [
            "S3のライフサイクルルール設定において、移行対象の日数を一時的に「0日（または1日）」に変更し、ファイル作成の翌日（または直後）にクラス移行が行われることを確認する"
        ],
        "explanation": "【解説】\n時間経過に依存するテストでは、設定値を一時的に短縮して確認するのが定石です。30日待つのは非現実的であり、サーバー時刻変更はマネージドサービスには通用しません。",
        "tags": ["第1章", "AWS", "シナリオ", "K3"]
    }
]

# 4. 第1章 金融 (ch1_finance_vol98.json)
q1_fin = [
    {
        "id": "Q1-FIN-V98-01",
        "chapter": "第1章",
        "level": "K4",
        "category": "金融",
        "style": "シナリオ",
        "type": "単一選択",
        "question": "【適用】日次バッチ処理の突き合わせテスト。\n銀行システムの勘定系ホストと情報系システムの間で、夜間バッチによるデータ連携が行われている。\n「データの欠損や不整合がないこと」を保証するために実施すべき、最も包括的な検証方法はどれか。",
        "options": [
            "情報系システムの画面でランダムに数件の口座データを表示し、勘定系の画面と見比べて値が同じであることを目視確認する（サンプリングのみで網羅性なし）",
            "バッチ処理の終了ステータスが「正常終了」になっていることだけを確認し、データの中身については検証しない（ログ監視のみでデータ品質不明）",
            "連携対象となる全データの「件数」と「金額合計（コントロールトータル）」を照合し、さらに全件の主要項目についてハッシュ値などを比較して差異がないことを機械的に検証する",
            "勘定系のデータベースをそのまま情報系にコピーし、バックアップとリストアが成功することを確認する（データ連携ロジックのテストになっていない）"
        ],
        "answer": [
            "連携対象となる全データの「件数」と「金額合計（コントロールトータル）」を照合し、さらに全件の主要項目についてハッシュ値などを比較して差異がないことを機械的に検証する"
        ],
        "explanation": "【解説】\n金融システムでは、件数と金額（コントロールトータル）の一致は絶対条件です。さらに全件比較ツール等を用いて内容の整合性を担保するのがベストプラクティスです。",
        "tags": ["第1章", "金融", "シナリオ", "K4"]
    }
]

# 5. 第2章 医療 (ch2_medical_vol98.json)
q2_med = [
    {
        "id": "Q2-MED-V98-01",
        "chapter": "第2章",
        "level": "K3",
        "category": "医療",
        "style": "シナリオ",
        "type": "単一選択",
        "question": "【適用】医療機器ソフトウェアの構成管理。\n手術支援ロボットの制御ソフトをアップデートする際、ハードウェアのバージョンとの「非互換性」により誤動作するリスクがある。\nこのリスクを防ぐための構成管理プロセスとして、最も重要な活動はどれか。",
        "options": [
            "最新のソフトウェアは常に最高の性能を発揮するため、古いハードウェアでも強制的に最新ソフトをインストールして動作させる（互換性無視）",
            "ソフトウェアとハードウェアの「適合するバージョンの組み合わせ（Configuration Matrix）」を明確に定義・管理し、リリース前にその組み合わせでの結合テストを必須とする",
            "ハードウェアのバージョン情報は管理せず、ソフトウェアのバージョン番号だけをインクリメントして管理する（構成要素の片手落ち）",
            "不具合が出たら現場の医師に対応を任せ、メーカーは関与しないという免責事項を契約書に盛り込む（製造物責任の放棄）"
        ],
        "answer": [
            "ソフトウェアとハードウェアの「適合するバージョンの組み合わせ（Configuration Matrix）」を明確に定義・管理し、リリース前にその組み合わせでの結合テストを必須とする"
        ],
        "explanation": "【解説】\n医療機器や組み込みシステムでは、ソフトとハードの組み合わせ管理（Configuration Management）が生命線です。マトリクス管理と実機検証が必須です。",
        "tags": ["第2章", "医療", "シナリオ", "K3"]
    }
]

# ==========================================
# ファイル書き出し
# ==========================================
files = {
    "ch2_general_vol98.json": q2_gen,
    "ch3_general_vol98.json": q3_gen,
    "ch1_aws_vol98.json": q1_aws,
    "ch1_finance_vol98.json": q1_fin,
    "ch2_medical_vol98.json": q2_med
}

for filename, content in files.items():
    file_path = os.path.join(OUTPUT_DIR, filename)
    with open(file_path, 'w', encoding='utf-8') as f:
        json.dump(content, f, ensure_ascii=False, indent=2)
    print(f"Created: {filename}")

print("-" * 30)
print("完了: Vol.98 のファイル生成が完了しました。")