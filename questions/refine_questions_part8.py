import json
import os
import glob

# ファイルが保存されているディレクトリ
BASE_DIR = "."

# ==========================================
# 修正データ定義（第8弾・総仕上げ）
# ==========================================
fixes = {
    # ---------------------------
    # 第1章 AWS (ch1_aws.json)
    # ---------------------------
    "Q1-AWS-01": {
        "options": [
            "予期せぬトラフィック急増によるAWS利用料のコスト超過（FinOpsリスク）",
            "スケーリング時の弾力性と整合性（ステートレス性の確保、データロスト）",
            "スケールアウト設定ミスによるインスタンスの無限起動ループ",
            "リージョン全体の障害による可用性の低下"
        ],
        "answer": ["スケーリング時の弾力性と整合性（ステートレス性の確保、データロスト）"]
    },
    "Q1-AWS-02": {
        "options": [
            "テスト環境構築にかかるエンジニアの人件費",
            "従量課金（リソース費：特に負荷テスト時のデータ転送量や高スペック機）",
            "サードパーティ製テストツールのライセンス費用",
            "テストデータ作成のためのストレージ保管コスト"
        ],
        "answer": ["従量課金（リソース費：特に負荷テスト時のデータ転送量や高スペック機）"]
    },
    "Q1-AWS-03": {
        "options": [
            "データセンターの物理的な入退室管理と電源設備の冗長化",
            "EC2上のOSパッチ適用、ミドルウェア設定、アプリケーションのセキュリティ",
            "AWSグローバルインフラストラクチャ（リージョン、AZ、エッジロケーション）の維持",
            "ハイパーバイザー層の仮想化セキュリティ"
        ],
        "answer": ["EC2上のOSパッチ適用、ミドルウェア設定、アプリケーションのセキュリティ"]
    },
    "Q1-AWS-05": {
        "options": [
            "本番環境に近いステージング環境でランダムにサーバーを停止させ、システムの自己修復能力を確認する",
            "本番環境での障害注入による回復性検証（Resiliency Testing）",
            "カオス理論に基づき、テストデータの組み合わせを数理的に最適化する",
            "開発チームと運用チームの役割を入れ替え、組織的な対応力を試す"
        ],
        "answer": ["本番環境での障害注入による回復性検証（Resiliency Testing）"]
    },
    "Q1-AWS-06": {
        "options": [
            "運用上の優秀性（Operational Excellence）",
            "信頼性（Reliability）",
            "テスト容易性（Testability）", # 5つの柱には含まれない
            "コスト最適化（Cost Optimization）"
        ],
        "answer": ["テスト容易性（Testability）"]
    },

    # ---------------------------
    # 第1章 クラウド (ch1_cloud.json)
    # ---------------------------
    "Q1-CLD-01": {
        "options": [
            "テスト実行をリリース直前のステージング環境のみに集中させる",
            "開発初期（要件・設計・実装）からテスト活動を開始し、欠陥を早期発見する",
            "テストチームを開発チームから物理的に隔離し、独立性を保つ（Left-side）",
            "すべてのテストを手動で行い、人間の直感（左脳）を重視する"
        ],
        "answer": ["開発初期（要件・設計・実装）からテスト活動を開始し、欠陥を早期発見する"]
    },
    "Q1-CLD-03": {
        "options": [
            "全ユーザーに対して新機能を一斉に公開し、フィードバックを最大化する",
            "影響範囲を限定した本番検証（TiP）として、一部ユーザーのみに公開しリスクを制御する",
            "テスト環境（ステージング）での検証を完全に省略し、スピードを最優先する",
            "開発者が自分の端末で確認しただけでリリースとする"
        ],
        "answer": ["影響範囲を限定した本番検証（TiP）として、一部ユーザーのみに公開しリスクを制御する"]
    },
    "Q1-CLD-04": {
        "options": [
            "障害発生時に自動的に復旧する能力（回復性）",
            "負荷に応じたリソースの自動増減能力（Elasticity）",
            "他社のクラウドサービスへ容易に移行できる能力（移植性）",
            "長期間停止せずに稼働し続ける能力（信頼性）"
        ],
        "answer": ["負荷に応じたリソースの自動増減能力（Elasticity）"]
    },

    # ---------------------------
    # 第1章 一般 (ch1_general.json)
    # ---------------------------
    "Q1-GEN-01": {
        "options": [
            "テスト担当者が「これ以上バグは見つからない」と直感した時",
            "ステークホルダーと事前に合意された完了条件（カバレッジ、残存リスク、重要バグ0件など）",
            "プロジェクトのスケジュール期限（納期）が到来した時",
            "開発マネージャーがリリースの承認印を押した時"
        ],
        "answer": ["ステークホルダーと事前に合意された完了条件（カバレッジ、残存リスク、重要バグ0件など）"]
    },
    "Q1-GEN-03": {
        "options": [
            "最大値・最小値・平均値",
            "楽観値（Best）・悲観値（Worst）・最頻値（Most Likely）",
            "初期見積もり・中間見積もり・最終見積もり",
            "開発工数・テスト工数・修正工数"
        ],
        "answer": ["楽観値（Best）・悲観値（Worst）・最頻値（Most Likely）"]
    },
    "Q1-GEN-07": {
        "options": [
            "リスク回避（リスクとなる機能そのものを実装しない）",
            "テストを行って欠陥を見つけ、修正することで品質リスクを低減する",
            "リスク受容（発生しても仕方ないと判断し、対策しない）",
            "リスク転嫁（保険への加入や、契約による免責事項の追加）"
        ],
        "answer": ["テストを行って欠陥を見つけ、修正することで品質リスクを低減する"]
    },
    "Q1-GEN-09": {
        "options": [
            "テストケース準備数、実行数、合格率（Pass/Fail）、欠陥検出推移",
            "テスト担当者の出勤率や残業時間などの労務データ",
            "テスト環境で使用しているサーバーのCPU温度や電力消費量",
            "開発者が書いたソースコードの行数（LOC）とコメント率"
        ],
        "answer": ["テストケース準備数、実行数、合格率（Pass/Fail）、欠陥検出推移"]
    },

    # ---------------------------
    # 第1章 医療 (ch1_medical.json)
    # ---------------------------
    "Q1-MED-01": {
        "options": [
            "最新の流行を取り入れたUIデザインと配色",
            "安全性クラス（Class I/II/III）に応じた検証活動と、要件からテストまでのトレーサビリティ",
            "市場投入までのスピード（Time to Market）を最優先したスケジュール",
            "開発コストを最小限に抑えるためのオープンソース利用計画"
        ],
        "answer": ["安全性クラス（Class I/II/III）に応じた検証活動と、要件からテストまでのトレーサビリティ"]
    },
    "Q1-MED-04": {
        "options": [
            "査察官をもてなすための会議室と食事の準備",
            "整理され、履歴管理された設計・テスト文書（DHF: Design History File）",
            "最新のハイスペックな開発用PCの展示",
            "開発チーム全員の集合写真と経歴書"
        ],
        "answer": ["整理され、履歴管理された設計・テスト文書（DHF: Design History File）"]
    },
    "Q1-MED-05": {
        "options": [
            "医療機器内で動作する、自社開発の独自アルゴリズム",
            "出所不明または開発プロセスが不明なサードパーティ製ソフト（OS、ライブラリ等）",
            "食品安全基準を満たした、人体に無害なソフトウェア",
            "患者の生体データを解析するためのAIモデル"
        ],
        "answer": ["出所不明または開発プロセスが不明なサードパーティ製ソフト（OS、ライブラリ等）"]
    },

    # ---------------------------
    # 第2章 クラウド (ch2_cloud.json)
    # ---------------------------
    "Q2-CLD-01": {
        "options": [
            "SLA（サービスレベル合意）およびSLO（サービスレベル目標）",
            "WBS（Work Breakdown Structure）の進捗率",
            "LOC（Lines of Code）と循環的複雑度",
            "開発チームの平均年齢と経験年数"
        ],
        "answer": ["SLA（サービスレベル合意）およびSLO（サービスレベル目標）"]
    },
    "Q2-CLD-02": {
        "options": [
            "分離性（Isolation）：あるテナントの負荷やデータ漏洩が他テナントに影響しないこと",
            "カスタマイズ性：各テナントが自由にソースコードを書き換えられること",
            "インストール性：ユーザーのPCに専用クライアントを導入しやすいこと",
            "魅力性：画面デザインが洗練されており、ユーザーを惹きつけること"
        ],
        "answer": ["分離性（Isolation）：あるテナントの負荷やデータ漏洩が他テナントに影響しないこと"]
    },
    "Q2-CLD-03": {
        "options": [
            "認証・認可の不備、レート制限（DoS対策）、インジェクション脆弱性",
            "APIのエンドポイントURLの命名規則がRESTfulであるか",
            "レスポンスのJSONが見やすく整形（Pretty Print）されているか",
            "APIドキュメントのフォントサイズや配色が見やすいか"
        ],
        "answer": ["認証・認可の不備、レート制限（DoS対策）、インジェクション脆弱性"]
    },
    "Q2-CLD-04": {
        "options": [
            "モバイル端末（スマホ・タブレット）での表示崩れがないこと",
            "オンプレミスや他クラウドへの移行容易性（ベンダーロックイン回避）",
            "USBメモリに入れて持ち運べること",
            "アプリケーションの動作が軽量で高速であること"
        ],
        "answer": ["オンプレミスや他クラウドへの移行容易性（ベンダーロックイン回避）"]
    },

    # ---------------------------
    # 第3章 AWS (ch3_aws.json)
    # ---------------------------
    "Q3-AWS-01": {
        "options": [
            "知識不足のメンバーをプロジェクトから外し、外部の専門ベンダーに委託する",
            "公式トレーニングの受講推奨や、経験者とのペアテスティングによるOJT",
            "AWSの利用を禁止し、慣れ親しんだオンプレミス環境に戻す",
            "マニュアルを読む時間を業務時間外に設け、自己責任で学習させる"
        ],
        "answer": ["公式トレーニングの受講推奨や、経験者とのペアテスティングによるOJT"]
    },
    "Q3-AWS-03": {
        "options": [
            "資格保有者数を競合他社に自慢するため",
            "共通言語（用語）の習得とアーキテクチャ理解によるテスト効率化",
            "オフィスの壁に合格証書を飾って見栄えを良くするため",
            "資格手当を支給して、給与調整の材料にするため"
        ],
        "answer": ["共通言語（用語）の習得とアーキテクチャ理解によるテスト効率化"]
    },
    "Q3-AWS-05": {
        "options": [
            "業務時間中にゲームをしてリフレッシュする",
            "本番想定のトラブルシューティングをチームで実践し、対応力を高める",
            "AWSのノベルティグッズ（Tシャツ等）をもらうためだけに参加する",
            "日常業務をサボるための口実にする"
        ],
        "answer": ["本番想定のトラブルシューティングをチームで実践し、対応力を高める"]
    },

    # ---------------------------
    # 第3章 クラウド (ch3_cloud.json)
    # ---------------------------
    "Q3-CLD-02": {
        "options": [
            "SREはインフラ構築のみを行い、テストチームとは関わらない",
            "SLO（サービスレベル目標）の定義やカオスエンジニアリングで協力し、信頼性を向上させる",
            "テストチームが発見したバグをSREが修正する（開発者の代わり）",
            "SREがテストチームを指揮命令し、上下関係の下で管理する"
        ],
        "answer": ["SLO（サービスレベル目標）の定義やカオスエンジニアリングで協力し、信頼性を向上させる"]
    },
    "Q3-CLD-05": {
        "options": [
            "業務中の雑談が増え、チームの雰囲気が明るくなる",
            "オペレーションや通知がチャットに集約され、チームの状況認識（Context）が共有される",
            "重要なアラートがチャットのログに埋もれてしまい、見逃しが増える",
            "コマンド操作をチャットで行うため、セキュリティリスクが増大する"
        ],
        "answer": ["オペレーションや通知がチャットに集約され、チームの状況認識（Context）が共有される"]
    },

    # ---------------------------
    # 第1章 金融 (ch1_finance.json)
    # ---------------------------
    "Q1-FIN-04": {
        "options": [
            "接続可能時間（オンライン稼働時間）やテスト用電文の種類・件数の制限",
            "接続先担当者の個人的なスケジュールや好み",
            "使用するLANケーブルの色やメーカーの指定",
            "テストデータの伝送における物理的な距離"
        ],
        "answer": ["接続可能時間（オンライン稼働時間）やテスト用電文の種類・件数の制限"]
    },
    "Q1-FIN-05": {
        "options": [
            "年1回以上のASVスキャンおよびペネトレーションテストの実施",
            "Webサイトのロゴデザインや配色に関するユーザビリティテスト",
            "社員の福利厚生としての旅行プランの策定",
            "ATMの筐体デザインに関するアンケート調査"
        ],
        "answer": ["年1回以上のASVスキャンおよびペネトレーションテストの実施"]
    },

    # ---------------------------
    # 第2章 AWS (ch2_aws.json)
    # ---------------------------
    "Q2-AWS-01": {
        "options": [
            "IaCテンプレート（CloudFormation/Terraform）のコードレビュー",
            "データセンターの空調温度や湿度",
            "物理サーバーの設置場所における警備体制",
            "マネジメントコンソールの配色の見やすさ"
        ],
        "answer": ["IaCテンプレート（CloudFormation/Terraform）のコードレビュー"]
    },

    # ---------------------------
    # 第2章 金融 (ch2_finance.json)
    # ---------------------------
    "Q2-FIN-01": {
        "options": [
            "金銭的損失リスク（Loss Risk）",
            "法的・規制要件への違反（Compliance Risk）",
            "担当者の個人的な好み",
            "画面デザインの流行"
        ],
        "answer": ["金銭的損失リスク（Loss Risk）", "法的・規制要件への違反（Compliance Risk）"]
    },
    "Q2-FIN-04": {
        "options": [
            "ユーザーが本人であることを証明できること（認証・真正性）",
            "開発者が真面目に誠実にシステムを作っていること",
            "システムがバグなく正常に動作すること（機能的正確性）",
            "処理速度が十分に速いこと（性能効率性）"
        ],
        "answer": ["ユーザーが本人であることを証明できること（認証・真正性）"]
    },

    # ---------------------------
    # 第2章 一般 (ch2_general.json)
    # ---------------------------
    "Q2-GEN-01": {
        "options": [
            "テスト担当者の個人的な感想や苦情",
            "再現手順、環境情報、期待値と実際の動作の差異（ログやスクショ含む）",
            "欠陥を発見した正確な時刻（ミリ秒単位）",
            "開発者への批判や人格攻撃"
        ],
        "answer": ["再現手順、環境情報、期待値と実際の動作の差異（ログやスクショ含む）"]
    },
    "Q2-GEN-07": {
        "options": [
            "ユーザーにとっての使いやすさ（ユーザビリティ）",
            "他のシステムや製品と情報を交換・利用する能力（インターオペラビリティ）",
            "障害発生時から正常な状態に復旧する能力（回復性）",
            "ユーザーが操作方法を学習するのにかかる時間（習得性）"
        ],
        "answer": ["他のシステムや製品と情報を交換・利用する能力（インターオペラビリティ）"]
    },

    # ---------------------------
    # 第2章 医療 (ch2_medical.json)
    # ---------------------------
    "Q2-MED-01": {
        "options": [
            "ログファイル等に患者の氏名や病歴などの個人情報（PII）が平文で出力されていないか",
            "画面のボタンの角が丸くなっており、親しみやすいデザインか",
            "データベースのテーブル名が医学用語として正しいか",
            "画面の背景色が目に優しい色合いになっているか"
        ],
        "answer": ["ログファイル等に患者の氏名や病歴などの個人情報（PII）が平文で出力されていないか"]
    },
    "Q2-MED-05": {
        "options": [
            "アラーム音が音楽的で、聞いていて心地よいか",
            "危険な状態を検知した際、遅延なく確実に警報が鳴り、ユーザーが識別できるか",
            "アラーム音量が十分に小さく、患者の睡眠を妨げないか",
            "好きな曲をアラーム音として設定できるか"
        ],
        "answer": ["危険な状態を検知した際、遅延なく確実に警報が鳴り、ユーザーが識別できるか"]
    },

    # ---------------------------
    # 第1章 金融 Vol.2 (ch1_finance_vol2.json)
    # ---------------------------
    "Q1-FIN-V2-01": {
        "options": [
            "最新のグラフィック技術を駆使した美しい画面デザイン",
            "高齢者や障害者を含む多様な利用者が、迷わず誤操作なく利用できること（アクセシビリティ）",
            "ユーザーを楽しませるための豊富なアニメーション効果",
            "英語だけでなく、世界中のあらゆる言語に対応していること"
        ],
        "answer": ["高齢者や障害者を含む多様な利用者が、迷わず誤操作なく利用できること（アクセシビリティ）"]
    },

    # ---------------------------
    # 第3章 金融 (ch3_finance.json)
    # ---------------------------
    "Q3-FIN-01": {
        "options": [
            "開発チームへの甘えを防止し、緊張感を持たせるため",
            "監査上の利益相反を回避し、客観的な品質証明（エビデンス）を確保するため",
            "テスト担当者の給与を低く抑えるため",
            "高価なテスト自動化ツールを導入しやすくするため"
        ],
        "answer": ["監査上の利益相反を回避し、客観的な品質証明（エビデンス）を確保するため"]
    },
    "Q3-FIN-04": {
        "options": [
            "開発はベンダーの責任であるため、納品物をそのまま検収する（丸投げ）",
            "受け入れテスト（UAT）の主体は自行（発注者）であることを認識し、検証プロセスに関与する",
            "ベンダーに対して損害賠償をちらつかせ、脅して品質を上げさせる",
            "直ちに契約を解除し、すべてのシステムを内製化する"
        ],
        "answer": ["受け入れテスト（UAT）の主体は自行（発注者）であることを認識し、検証プロセスに関与する"]
    },

    # ---------------------------
    # 第3章 一般 (ch3_general.json)
    # ---------------------------
    "Q3-GEN-01": {
        "options": [
            "メンバーの能力を点数化し、給与査定の減点材料にする",
            "チーム内の競争を煽り、ライバル意識を高める",
            "チームのスキルギャップを特定し、教育計画や採用計画に役立てる",
            "他部署に対してチームの優位性を誇示する"
        ],
        "answer": ["チームのスキルギャップを特定し、教育計画や採用計画に役立てる"]
    },
    "Q3-GEN-05": {
        "options": [
            "複雑なアルゴリズムを実装できる高度なコーディング能力",
            "前提を疑う批判的思考（クリティカルシンキング）と、対立を生まないコミュニケーション能力",
            "長時間の残業に耐えうる体力と握力",
            "休憩時間を惜しんで食事を済ませる早食いのスキル"
        ],
        "answer": ["前提を疑う批判的思考（クリティカルシンキング）と、対立を生まないコミュニケーション能力"]
    },
    "Q3-GEN-06": {
        "options": [
            "コミュニケーションコストを下げるため、全員同じ考え方を持つ人を採用する",
            "「殺虫剤のパラドックス」を防ぐため、多様なバックグラウンド（ドメイン知識、技術力）を持つ人を採用する",
            "人件費を抑えるため、給与の安い未経験者のみを採用する",
            "信頼関係重視のため、社長や役員の知人・友人を優先的に採用する"
        ],
        "answer": ["「殺虫剤のパラドックス」を防ぐため、多様なバックグラウンド（ドメイン知識、技術力）を持つ人を採用する"]
    },

    # ---------------------------
    # 第3章 医療 (ch3_medical.json)
    # ---------------------------
    "Q3-MED-03": {
        "options": [
            "開発者の提案した変更を原則として全て却下し、現状維持を図る",
            "変更による安全性への影響を評価し、リスクが許容範囲内であるか承認する",
            "チームの懇親会や飲み会を企画し、メンバーの士気を高める",
            "テストコードの実装を行い、自動化率を向上させる"
        ],
        "answer": ["変更による安全性への影響を評価し、リスクが許容範囲内であるか承認する"]
    },

    # ---------------------------
    # 第1章 AWS Vol.2 (ch1_aws_vol2.json)
    # ---------------------------
    "Q1-AWS-V2-01": {
        "options": [
            "Multi-AZ構成でのフェイルオーバー試験（強制再起動時の切り替わり時間確認）",
            "本番データベースのバックアップを削除し、復元できないことを確認する",
            "データセンターの電源ケーブルを物理的に切断するシミュレーション",
            "OSを再インストールし、データが保持されるか確認する"
        ],
        "answer": ["Multi-AZ構成でのフェイルオーバー試験（強制再起動時の切り替わり時間確認）"]
    },

    # ---------------------------
    # 第3章 AWS Vol.2 (ch3_aws_vol2.json)
    # ---------------------------
    "Q3-AWS-V2-01": {
        "options": [
            "チーム内にかっこいいメンバーがいることで、モチベーションが上がる",
            "CI/CDパイプラインの構築やIaCのテスト戦略を主導し、自動化を推進できる",
            "AWSパートナー特典により、利用料金が無料になる",
            "開発作業を全て代行してもらえるため、他のメンバーが楽になる"
        ],
        "answer": ["CI/CDパイプラインの構築やIaCのテスト戦略を主導し、自動化を推進できる"]
    },

    # ---------------------------
    # 第3章 クラウド Vol.2 (ch3_cloud_vol2.json)
    # ---------------------------
    "Q3-CLD-V2-01": {
        "options": [
            "業務中はWebカメラを常時ONにさせ、サボっていないか監視する",
            "バーチャルオフィスや雑談チャットなど、心理的安全性を高める場の提供とメンター制度",
            "リモートワークを禁止し、全員出社を強制する",
            "個人の自律性を尊重するという名目で、コミュニケーション不足を放置する"
        ],
        "answer": ["バーチャルオフィスや雑談チャットなど、心理的安全性を高める場の提供とメンター制度"]
    },
    
    # ---------------------------
    # 第1章 一般 Vol.5 (ch1_general_vol5.json)
    # ---------------------------
    "Q1-GEN-V5-01": {
        "options": [
            "テストプロセス（組織、管理、動的、静的）",
            "テストドキュメント（IEEE 829準拠）",
            "テスト技法（ブラックボックス、ホワイトボックス等）",
            "テスト担当者の給与基準や評価制度"
        ],
        "answer": ["テスト担当者の給与基準や評価制度"]
    },
    "Q1-GEN-V5-03": {
        "options": [
            "テスト工程で85%のバグを見つけ、残り15%は市場（本番）流出してしまった（市場流出バグがある）",
            "テストケースの85%が合格し、残り15%が不合格だった（進捗率）",
            "開発チームの85%が優秀なスキルを持っている",
            "テスト自動化率が85%に達しており、手動テストが少ない"
        ],
        "answer": ["テスト工程で85%のバグを見つけ、残り15%は市場（本番）流出してしまった（市場流出バグがある）"]
    },
    "Q1-GEN-V5-06": {
        "options": [
            "将来の保守担当者や、リリース判定を行うステークホルダー（意思決定者）",
            "テストツールを提供している外部ベンダー",
            "競合他社のマーケティング部門",
            "テストデータの入力を行うアルバイトスタッフ"
        ],
        "answer": ["将来の保守担当者や、リリース判定を行うステークホルダー（意思決定者）"]
    },
    "Q1-GEN-V5-07": {
        "options": [
            "機能の複雑さと数（EI/EO/EQ/ILF/EIF）に基づいて規模を算出し、そこから工数を導く",
            "過去の類似プロジェクトの工数をそのまま流用する（類推見積もり）",
            "ソースコードの行数（LOC）を数えて規模とする",
            "担当者の経験と勘（KKD）のみで決定する"
        ],
        "answer": ["機能の複雑さと数（EI/EO/EQ/ILF/EIF）に基づいて規模を算出し、そこから工数を導く"]
    },

    # ---------------------------
    # 第2章 クラウド Vol.5 (ch2_cloud_vol5.json)
    # ---------------------------
    "Q2-CLD-V5-02": {
        "options": [
            "OSパッケージやライブラリの既知の脆弱性（CVE）や、機密情報のハードコード",
            "ソースコードのインデントのズレやコメントの不足",
            "変数名の命名規則違反（キャメルケースかスネークケースか等）",
            "コンテナイメージに含まれる画像の解像度やファイルサイズ"
        ],
        "answer": ["OSパッケージやライブラリの既知の脆弱性（CVE）や、機密情報のハードコード"]
    },

    # ---------------------------
    # 第3章 ファイナンス Vol.5 (ch3_finance_vol5.json)
    # ---------------------------
    "Q3-FIN-V5-01": {
        "options": [
            "各ベンダーに完全に任せ、発注者は一切干渉しない",
            "ベンダー間の責任分界点（インターフェースやデータ授受）を明確にし、統合テストの方針を全体統括する",
            "ベンダー同士を競わせ、早く終わった方にボーナスを出す",
            "親睦を深めるため、毎日飲み会を開いてコミュニケーションをとる"
        ],
        "answer": ["ベンダー間の責任分界点（インターフェースやデータ授受）を明確にし、統合テストの方針を全体統括する"]
    },

    # ---------------------------
    # 第1章 ファイナンス Vol.5 (ch1_finance_vol5.json)
    # ---------------------------
    "Q1-FIN-V5-01": {
        "options": [
            "机上訓練（読み合わせ）だけでなく、実際にシステムを切り替えたり、バックアップセンターで業務再開できるか総合訓練を行う",
            "計画書を作成し、金庫に大切に保管しておく（訓練は実施しない）",
            "担当者に抜き打ちテストを行い、計画書の内容を暗記しているか確認する",
            "避難訓練のみを行い、システムの復旧手順は確認しない"
        ],
        "answer": ["机上訓練（読み合わせ）だけでなく、実際にシステムを切り替えたり、バックアップセンターで業務再開できるか総合訓練を行う"]
    }
}

def refine_questions():
    all_files = glob.glob(os.path.join(BASE_DIR, "*.json"))
    updated_count = 0

    print("第8弾：問題データの修正を開始します...")

    for file_path in all_files:
        filename = os.path.basename(file_path)
        # スクリプトファイルなどは除外
        if filename.endswith(".py") or filename == "index.json":
            continue
            
        try:
            with open(file_path, 'r', encoding='utf-8') as f:
                data = json.load(f)
            
            if not isinstance(data, list):
                continue

            file_modified = False
            
            for q in data:
                q_id = q.get("id")
                
                if q_id in fixes:
                    fix_data = fixes[q_id]
                    
                    if "options" in fix_data:
                        q["options"] = fix_data["options"]
                    if "answer" in fix_data:
                        q["answer"] = fix_data["answer"]
                    if "explanation" in fix_data:
                        q["explanation"] = fix_data["explanation"]

                    print(f"  修正適用: {q_id} ({filename})")
                    file_modified = True

            if file_modified:
                with open(file_path, 'w', encoding='utf-8') as f:
                    json.dump(data, f, ensure_ascii=False, indent=2)
                updated_count += 1
                
        except Exception as e:
            print(f"  読み込みエラー: {filename} - {e}")

    print("-" * 30)
    print(f"完了: 合計 {updated_count} ファイルの問題を修正しました。")

if __name__ == "__main__":
    refine_questions()