import json
import os

OUTPUT_FILE = "ch3_ai_extra_high.json"

new_questions = [
  {
    "id": "Q-AI-HIGH-01",
    "chapter": "第3章",
    "level": "K4",
    "category": "AIセキュリティ",
    "style": "シナリオ",
    "type": "単一選択",
    "question": "【シナリオ】自動運転車の画像認識モデルに対し、道路標識の画像に人間には知覚できない微小なノイズを加えたところ、モデルは「一時停止」を「制限速度60km」と誤認識して加速してしまった。\n\nこの攻撃手法として最も適切な名称はどれか。",
    "options": [
      "データポイズニング攻撃（Data Poisoning）",
      "モデル抽出攻撃（Model Extraction）",
      "回避攻撃（Evasion Attack / Adversarial Example）",
      "モデルインバージョン攻撃（Model Inversion）"
    ],
    "answer": [
      "回避攻撃（Evasion Attack / Adversarial Example）"
    ],
    "explanation": "【解説】\n運用中のモデルに対し、入力データに細工をして誤分類させる攻撃は「回避攻撃（Evasion Attack）」です。この入力データは「敵対的サンプル（Adversarial Example）」と呼ばれます。\n\n・データポイズニング：学習データに毒（不正データ）を混ぜて、モデル自体を汚染する攻撃。\n・モデル抽出：APIなどの応答から、モデルのパラメータや構造を盗む攻撃。",
    "tags": ["AI", "セキュリティ", "敵対的攻撃"]
  },
  {
    "id": "Q-AI-HIGH-02",
    "chapter": "第3章",
    "level": "K4",
    "category": "テスト技法",
    "style": "文章",
    "type": "単一選択",
    "question": "【分析】検索エンジンのランキングアルゴリズムをテストしたいが、正解となる「正しい順位」を事前に定義することが難しい（テストオラクル問題）。\nそこで、「検索クエリに特定の単語を追加しても、元の検索結果に含まれていた主要なページは、順位が変わったとしても結果リストから消えるべきではない」という関係性を利用してテストを行うことにした。\n\nこのテストアプローチはどれか。",
    "options": [
      "A/Bテスト",
      "メタモルフィックテスト（Metamorphic Testing）",
      "バック・トゥ・バックテスト",
      "ペアワイズテスト"
    ],
    "answer": [
      "メタモルフィックテスト（Metamorphic Testing）"
    ],
    "explanation": "【解説】\n正解（絶対的なオラクル）が分からない場合に、「入力Aと入力Bの関係」から「出力Aと出力Bの関係」を検証する手法を「メタモルフィックテスト」と呼びます。\n設問の「順位は変わっても、含まれるページは維持されるべき」というのは「メタモルフィック関係（MR）」の一例です。",
    "tags": ["AI", "テスト技法", "メタモルフィック"]
  },
  {
    "id": "Q-AI-HIGH-03",
    "chapter": "第3章",
    "level": "K4",
    "category": "データ品質",
    "style": "シナリオ",
    "type": "単一選択",
    "question": "【シナリオ】住宅価格予測モデルの訓練において、データサイエンティストが「データセット全体」を使って前処理（正規化のための平均値・標準偏差の算出）を行い、その後にデータを「訓練用」と「テスト用」に分割した。\n\nこのプロセスにおける最大の問題点は何か。",
    "options": [
      "データ分割の比率が明記されていない",
      "データスヌーピング（Data Snooping / Data Leakage）が発生している",
      "正規化ではなく標準化を行うべきである",
      "テストデータが不足する可能性がある"
    ],
    "answer": [
      "データスヌーピング（Data Snooping / Data Leakage）が発生している"
    ],
    "explanation": "【解説】\nテストデータ（未知のデータであるべきもの）の情報を使って前処理を行ってしまっています（テストデータの平均値などが訓練に漏れている）。\nこれを「データスヌーピング（リーク）」と呼び、テスト時の性能が不当に高く出てしまう原因となります。\n正しい手順は「分割した後」に、訓練データのみを使って前処理のパラメータを決めることです。",
    "tags": ["AI", "データ", "リーク"]
  },
  {
    "id": "Q-AI-HIGH-04",
    "chapter": "第3章",
    "level": "K4",
    "category": "公平性",
    "style": "文章",
    "type": "単一選択",
    "question": "【評価】AIを用いた採用システムの公平性を評価したい。\n特定の保護属性（例：性別）に関わらず、採用される確率が同等であることを保証するための指標として、最も適切なものはどれか。",
    "options": [
      "正解率（Accuracy）の均等化",
      "人口統計学的平価（Demographic Parity）",
      "適合率（Precision）の最大化",
      "F値（F-measure）の統一"
    ],
    "answer": [
      "人口統計学的平価（Demographic Parity）"
    ],
    "explanation": "【解説】\n「保護属性（グループ）に関わらず、肯定的な結果（採用など）が出る割合が等しいこと」を求める指標は「人口統計学的平価（Demographic Parity）」です。\n\n・正解率や適合率は「精度」の指標であり、バイアスの有無を直接示すものではありません。",
    "tags": ["AI", "公平性", "バイアス"]
  },
  {
    "id": "Q-AI-HIGH-05",
    "chapter": "第3章",
    "level": "K3",
    "category": "構造カバレッジ",
    "style": "文章",
    "type": "単一選択",
    "question": "【理解】ニューラルネットワークのテストにおける「ニューロンカバレッジ（Neuron Coverage）」の説明として、正しいものはどれか。",
    "options": [
      "ソースコードの全行が実行された割合を示す（従来のC0カバレッジと同じ）",
      "テストセットによって活性化（発火）したニューロンの割合を示す",
      "学習データに含まれる全パターンの網羅率を示す",
      "モデルの推論時間が許容範囲内であるかを示す"
    ],
    "answer": [
      "テストセットによって活性化（発火）したニューロンの割合を示す"
    ],
    "explanation": "【解説】\nニューロンカバレッジは、ディープラーニング特有の構造カバレッジで、「全ニューロンのうち、テスト実行時に入力によってしきい値を超えて活性化したニューロンの比率」を指します。\n※ただし、ニューロンカバレッジが高くても品質が高いとは限らない（欠陥検出能力との相関が低い場合がある）点に注意が必要です。",
    "tags": ["AI", "カバレッジ", "ニューラルネットワーク"]
  }
]

def create_ch3_high():
    print(f"--- 第3章 高難易度問題 {OUTPUT_FILE} の作成 ---")
    try:
        with open(OUTPUT_FILE, 'w', encoding='utf-8') as f:
            json.dump(new_questions, f, ensure_ascii=False, indent=2)
        print(f"✅ 作成完了: {len(new_questions)} 問を追加しました。")
    except Exception as e:
        print(f"❌ エラー: {e}")

if __name__ == "__main__":
    create_ch3_high()
    input("エンターキーを押して終了...")