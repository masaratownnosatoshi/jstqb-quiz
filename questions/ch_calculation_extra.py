import json
import os

OUTPUT_FILE = "ch_calculation_extra.json"

new_questions = [
  {
    "id": "Q-CALC-EXTRA-01",
    "chapter": "第1章",
    "level": "K3",
    "category": "見積もり",
    "style": "計算",
    "type": "単一選択",
    "question": "【計算】3点見積もり（PERT法）。\nあるテストタスクの見積もりを行ったところ、以下の数値が出た。\n\n・楽観値（最良）：5人日\n・最頻値（通常）：8人日\n・悲観値（最悪）：17人日\n\n加重平均（期待値）を用いた場合、このタスクの見積もり工数は何人日になるか。",
    "options": [
      "8.5 人日",
      "9.0 人日",
      "10.0 人日",
      "11.5 人日"
    ],
    "answer": [
      "9.0 人日"
    ],
    "explanation": "【解説】\n3点見積もり（PERT）の計算式は以下の通りです。\n$$E = \\frac{楽観値 + (4 \\times 最頻値) + 悲観値}{6}$$\n\n$$E = \\frac{5 + (4 \\times 8) + 17}{6} = \\frac{5 + 32 + 17}{6} = \\frac{54}{6} = 9.0$$\n\nしたがって、9.0人日となります。",
    "tags": ["計算", "見積もり", "PERT"]
  },
  {
    "id": "Q-CALC-EXTRA-02",
    "chapter": "第2章",
    "level": "K4",
    "category": "モニタリング",
    "style": "計算",
    "type": "単一選択",
    "question": "【計算】品質コスト（CoQ）の算出。\n今期のプロジェクトにおいて、以下のコストが発生した。\n\n1. テスト担当者の教育研修費：50万円\n2. 設計書のレビュー実施費：100万円\n3. テスト実行費：200万円\n4. リリース後の不具合対応費：300万円\n\nこのうち、「適合コスト（予防コスト＋評価コスト）」の合計額はいくらか。",
    "options": [
      "150万円",
      "350万円",
      "450万円",
      "650万円"
    ],
    "answer": [
      "350万円"
    ],
    "explanation": "【解説】\n・予防コスト：欠陥を作らないための費用（教育研修費：50万円）\n・評価コスト：欠陥を見つけるための費用（レビュー：100万円 ＋ テスト実行：200万円）\n\n適合コスト ＝ 予防コスト ＋ 評価コスト\n$$50 + 100 + 200 = 350 \\text{万円}$$\n\n※リリース後の不具合対応（300万円）は「不適合コスト（外部失敗コスト）」に含まれます。",
    "tags": ["計算", "品質コスト", "CoQ"]
  },
  {
    "id": "Q-CALC-EXTRA-03",
    "chapter": "第1章",
    "level": "K3",
    "category": "見積もり",
    "style": "計算",
    "type": "単一選択",
    "question": "【計算】アジャイル開発のリリース計画。\n・プロダクトバックログの残存ストーリーポイント：240 SP\n・過去3回のスプリントのベロシティ：18 SP, 24 SP, 21 SP\n\nチームのベロシティが今後も平均通り推移すると仮定した場合、全てのバックログを消化するのに必要なスプリント数はいくつか。",
    "options": [
      "10 スプリント",
      "11 スプリント",
      "12 スプリント",
      "13 スプリント"
    ],
    "answer": [
      "12 スプリント"
    ],
    "explanation": "【解説】\n平均ベロシティ ＝ (18 + 24 + 21) ÷ 3 ＝ 21 SP/スプリント\n\n必要スプリント数 ＝ 残ポイント ÷ 平均ベロシティ\n$$240 \\div 21 \\approx 11.4$$\n\n11スプリントでは 231 SP しか消化できず残ってしまうため、切り上げて「12スプリント」必要です。",
    "tags": ["計算", "アジャイル", "ベロシティ"]
  },
  {
    "id": "Q-CALC-EXTRA-04",
    "chapter": "第2章",
    "level": "K3",
    "category": "モニタリング",
    "style": "計算",
    "type": "単一選択",
    "question": "【計算】EVM（アーンドバリューマネジメント）による分析。\nプロジェクト中盤での進捗状況は以下の通りであった。\n\n・PV（計画上の予算）：1000万円\n・EV（完了した作業の予算価値）：800万円\n・AC（実際にかかったコスト）：900万円\n\nこの時点での SPI（スケジュール効率指数）はいくらか。",
    "options": [
      "0.80",
      "0.89",
      "1.11",
      "1.25"
    ],
    "answer": [
      "0.80"
    ],
    "explanation": "【解説】\nSPI（スケジュール効率指数）は、計画に対する進捗の割合を示します。\n$$SPI = EV \\div PV$$\n$$800 \\div 1000 = 0.80$$\n\n※SPIが 1.0 を下回っているため、予定より遅れていることを示しています。\n（ちなみに CPI = EV/AC = 0.89 であり、コスト超過も発生しています）",
    "tags": ["計算", "EVM", "進捗管理"]
  },
  {
    "id": "Q-CALC-EXTRA-05",
    "chapter": "第1章",
    "level": "K3",
    "category": "見積もり",
    "style": "計算",
    "type": "単一選択",
    "question": "【計算】再テストを考慮した工数見積もり。\n・テストケース総数：500件\n・1日あたりのテスト実行能力：50件\n・初回テストでのＮＧ率（バグ検出率）：20％\n・修正後の確認テスト（再テスト）は、ＮＧ件数分だけ発生する\n\n確認テストを含め、すべてのテストを完了させるために必要な日数は何日か。",
    "options": [
      "10日",
      "11日",
      "12日",
      "13日"
    ],
    "answer": [
      "12日"
    ],
    "explanation": "【解説】\n1. 初回実行数：500件\n2. ＮＧ発生数：500件 × 20% = 100件（これが再テスト対象となる）\n3. 総実行件数：500件（初回）＋ 100件（再テスト）＝ 600件\n\n必要日数 ＝ 600件 ÷ 50件/日 ＝ 12日",
    "tags": ["計算", "見積もり", "工数"]
  }
]

def create_extra_calculations():
    print(f"--- 新規計算問題ファイル {OUTPUT_FILE} の作成 ---")
    
    try:
        with open(OUTPUT_FILE, 'w', encoding='utf-8') as f:
            json.dump(new_questions, f, ensure_ascii=False, indent=2)
        print(f"✅ 作成完了: {len(new_questions)} 問を追加しました。")
        print("注意: index.json を更新するために、必ず regenerate_index.py も実行してください。")
        
    except Exception as e:
        print(f"❌ エラー: {e}")

if __name__ == "__main__":
    create_extra_calculations()
    input("エンターキーを押して終了...")