import json
import os

# 保存先ディレクトリ（必要に応じて変更してください）
OUTPUT_DIR = "."

# ==========================================
# Vol.96 新規問題データ定義
# ==========================================

# 1. 第1章 一般 (ch1_general_vol96.json)
q1_gen = [
    {
        "id": "Q1-GEN-V96-01",
        "chapter": "第1章",
        "level": "K4",
        "category": "一般",
        "style": "シナリオ",
        "type": "単一選択",
        "question": "あなたはテストマネージャとして、テスト終了報告書を作成している。テスト期間中に「高リスク」なバグが複数発見されたが、全て修正・確認済みである。しかし、テストケースの一部（低リスク機能）が時間切れで未実施のまま残っている。\nこの状況をステークホルダーに報告する際、最も適切な表現はどれか。",
        "options": [
            "全ての高リスクバグが修正されたため、品質目標は完全に達成されており、未実施テストによる影響は皆無であると断言して、リリースを強く推奨する",
            "重要機能の品質は確保されたが、一部の低リスク機能におけるテスト未実施により、特定条件下での潜在的な不具合リスクが残存していることを明記し、運用での回避策と併せてリリース可否の判断を仰ぐ",
            "未実施のテストケースが存在することはプロジェクトの失敗を意味するため、リリースを無期限に延期し、全てのテストが完了するまで追加予算と人員を要求する",
            "未実施テストのことは報告書には記載せず、発見されたバグの修正状況とテスト合格率の高さだけを強調して、プロジェクトが成功したような印象を与える"
        ],
        "answer": [
            "重要機能の品質は確保されたが、一部の低リスク機能におけるテスト未実施により、特定条件下での潜在的な不具合リスクが残存していることを明記し、運用での回避策と併せてリリース可否の判断を仰ぐ"
        ],
        "explanation": "【解説】\nテストマネージャの責務は「完全な品質保証」ではなく「リスク情報の正確な提供」です。\n正解の選択肢は、ポジティブな面（重要バグ修正）とネガティブな面（残存リスク）をバランスよく伝え、ビジネス判断を仰いでいます。\n誤答の選択肢も文字数を揃えていますが、「断言する（過信）」「無期限延期（ビジネス無視）」「隠蔽（コンプライアンス違反）」といったアンチパターンになっています。",
        "tags": ["第1章", "一般", "シナリオ", "K4"]
    },
    {
        "id": "Q1-GEN-V96-02",
        "chapter": "第1章",
        "level": "K3",
        "category": "一般",
        "style": "用語",
        "type": "単一選択",
        "question": "「包括的なテスト戦略（Comprehensive Testing Strategy）」と「リスクベースドテスト戦略（Risk-Based Testing Strategy）」の主な違いに関する説明として、最も適切なものはどれか。",
        "options": [
            "包括的な戦略は、システム全体を網羅的にテストすることを重視し、リスクの大小に関わらず全ての機能に対して均等にテストリソースを配分するアプローチである",
            "リスクベースド戦略は、ステークホルダーが懸念するリスクのレベル（発生確率×影響度）に基づいてテストの優先順位と深さを決定し、限られたリソースで最大の効果を得ようとするアプローチである",
            "包括的な戦略は、テスト自動化ツールを全面的に導入して人間によるテストを排除することを目指し、リスクベースド戦略は手動テストに特化するアプローチである",
            "リスクベースド戦略は、発見された欠陥の修正を行わずにリリースすることを前提とし、ユーザーからのクレーム対応にリソースを集中させるアプローチである"
        ],
        "answer": [
            "リスクベースド戦略は、ステークホルダーが懸念するリスクのレベル（発生確率×影響度）に基づいてテストの優先順位と深さを決定し、限られたリソースで最大の効果を得ようとするアプローチである"
        ],
        "explanation": "【解説】\n正解はリスクベースドテストの正しい定義です。\n誤答（特に1番目）は、「包括的＝均等配分」というもっともらしい誤解を記述しており、文字数も正解と同程度にして推測を防いでいます。",
        "tags": ["第1章", "一般", "用語", "K3"]
    }
]

# 2. 第2章 金融 (ch2_finance_vol96.json)
q2_fin = [
    {
        "id": "Q2-FIN-V96-01",
        "chapter": "第2章",
        "level": "K4",
        "category": "金融",
        "style": "シナリオ",
        "type": "単一選択",
        "question": "銀行の勘定系システムにおいて、「外貨預金の利息計算」機能のテスト設計を行っている。この計算では、通貨ごとに異なる「端数処理ルール（切り捨て、四捨五入など）」が適用される。\nテストケースの設計方針として、最も信頼性が高く、かつ効率的なアプローチはどれか。",
        "options": [
            "主要な通貨（米ドル、ユーロ）のみを選定してテストを行い、その他のマイナー通貨についてはロジックが同じであると仮定して、テストを省略または簡略化する",
            "全ての通貨ペアと金利の組み合わせを網羅するために、直交表（Orthogonal Array）を用いて数千通りのテストケースを生成し、全量を自動テストで実行する",
            "通貨ごとの端数処理仕様に基づき、境界値分析を用いて「端数が発生する境界（0.4, 0.5, 0.6など）」となる金額パターンを特定し、各ルールが正しく適用されるかを確認する",
            "実際に本番環境で稼働している旧システムのログからランダムに取引データを抽出し、新システムに入力して結果が一致することを確認する（現新比較テストのみに依存する）"
        ],
        "answer": [
            "通貨ごとの端数処理仕様に基づき、境界値分析を用いて「端数が発生する境界（0.4, 0.5, 0.6など）」となる金額パターンを特定し、各ルールが正しく適用されるかを確認する"
        ],
        "explanation": "【解説】\n金融計算では「丸め誤差」が最大のリスクです。\n正解は「仕様に基づいた境界値分析」で論理的に網羅する方法です。\n誤答の「直交表で数千通り（過剰品質・現実的でない）」「現新比較のみ（仕様バグが温存されるリスク）」も長文で記述し、判断を迷わせるようにしています。",
        "tags": ["第2章", "金融", "シナリオ", "K4"]
    }
]

# 3. 第1章 AWS (ch1_aws_vol96.json)
q1_aws = [
    {
        "id": "Q1-AWS-V96-01",
        "chapter": "第1章",
        "level": "K3",
        "category": "AWS",
        "style": "シナリオ",
        "type": "単一選択",
        "question": "AWS上で稼働するWebサービスの「可用性テスト」を計画している。アベイラビリティーゾーン（AZ）の障害発生時に、システムが自動的に復旧することを確認したい。\n実施すべきテストシナリオと、期待される挙動の記述として最も適切なものはどれか。",
        "options": [
            "本番環境のデータベースサーバーを強制的にシャットダウンし、ユーザーからのアクセスが完全に遮断された状態で、運用チームが手動でバックアップから復旧させる手順を確認する",
            "テスト環境において、RDSの「再起動（フェイルオーバー付き）」を実行し、アプリケーションが自動的にスタンバイDBへ接続を切り替え、ダウンタイムがSLAの許容範囲内に収まることを計測する",
            "Webサーバーの負荷を意図的に急増させてCPU使用率を100%にし、Auto Scalingが機能して新しいインスタンスが起動するまでの間、サービスが停止しないことを確認する（これはスケーラビリティテスト）",
            "全てのリージョンのネットワークを遮断するカオスエンジニアリングツールを実行し、世界中のユーザーがアクセスできない状態を作り出し、システムの堅牢性を極限まで試す"
        ],
        "answer": [
            "テスト環境において、RDSの「再起動（フェイルオーバー付き）」を実行し、アプリケーションが自動的にスタンバイDBへ接続を切り替え、ダウンタイムがSLAの許容範囲内に収まることを計測する"
        ],
        "explanation": "【解説】\nAZ障害（フェイルオーバー）のテストとして適切なのは、RDSの機能を利用したシミュレーションです。\n誤答の「本番で手動復旧（リスク過大・自動化の否定）」「カオスエンジニアリング（過激すぎる・目的乖離）」も詳細に記述し、正解の「自動復旧・SLA計測」と対比させています。",
        "tags": ["第1章", "AWS", "シナリオ", "K3"]
    }
]

# 4. 第3章 一般 (ch3_general_vol96.json)
q3_gen = [
    {
        "id": "Q3-GEN-V96-01",
        "chapter": "第3章",
        "level": "K3",
        "category": "一般",
        "style": "シナリオ",
        "type": "単一選択",
        "question": "アジャイル開発チームにおいて、QA（品質保証）担当者がボトルネックになっている。開発ペースにテストが追いつかず、スプリント終了時に未検証のストーリーが残ることが多い。\n「ホールチームアプローチ（Whole Team Approach）」の考え方に基づき、この状況を改善するためのアクションはどれか。",
        "options": [
            "QA担当者の人数を倍に増やし、開発者が書いたコードを片っ端からテストすることで、開発スピードを落とさずに品質を担保する体制を構築する",
            "テストフェーズをスプリントの外に切り出し、開発が終わった後の「安定化スプリント」でまとめてテストを行うことで、スプリント内の負担を軽減する（ウォーターフォールへの逆行）",
            "品質に対する責任をQA担当者個人からチーム全体へとシフトし、開発者自身が単体テストやAPIテストを強化することで、QAは探索的テストや複雑なシナリオに集中できるようにする",
            "開発者のコーディング速度を落とすようにプロジェクトマネージャに要請し、QA担当者が現在の人数とスキルで対応できるペースに合わせて開発スケジュールを再調整する"
        ],
        "answer": [
            "品質に対する責任をQA担当者個人からチーム全体へとシフトし、開発者自身が単体テストやAPIテストを強化することで、QAは探索的テストや複雑なシナリオに集中できるようにする"
        ],
        "explanation": "【解説】\nホールチームアプローチの本質は「品質責任の共有」です。\n誤答の「QA増員（対症療法）」「安定化スプリント（アンチパターン）」「開発減速（ビジネス価値の毀損）」も、一見ありそうな解決策として長文で提示していますが、アジャイルの原則に照らすと不適切です。",
        "tags": ["第3章", "一般", "シナリオ", "K3"]
    }
]

# 5. 第2章 一般 (ch2_general_vol96.json)
q2_gen = [
    {
        "id": "Q2-GEN-V96-01",
        "chapter": "第2章",
        "level": "K4",
        "category": "一般",
        "style": "シナリオ",
        "type": "単一選択",
        "question": "欠陥分析の結果、「仕様の誤解」による手戻りが多発していることが判明した。根本原因分析（RCA）を進めたところ、仕様書が更新されず、口頭での変更依頼が常態化していることが分かった。\n再発防止策として、最も効果的かつ持続可能なプロセス改善はどれか。",
        "options": [
            "開発者とテスターの席を隣同士に配置し、仕様変更があるたびに口頭で即座に伝え合うことで、ドキュメント更新のタイムラグを無くし、情報の鮮度を保つ（属人化の助長）",
            "仕様変更プロセスを正式に定義し、チケット管理ツール等を用いて変更履歴と承認フローを可視化するとともに、仕様書の更新を完了条件（Definition of Done）に含める",
            "仕様書の更新を専任で行う「テクニカルライター」を新規に採用し、開発者はコーディングに専念させることで、ドキュメントの品質と開発速度の両立を図る（コスト増・当事者意識の希薄化）",
            "仕様変更を原則禁止とし、最初の要件定義で決めた内容をリリースまで凍結することで、仕様のブレによる手戻りを根本から排除する（アジリティの欠如）"
        ],
        "answer": [
            "仕様変更プロセスを正式に定義し、チケット管理ツール等を用いて変更履歴と承認フローを可視化するとともに、仕様書の更新を完了条件（Definition of Done）に含める"
        ],
        "explanation": "【解説】\n根本原因は「プロセスの欠如」です。\n正解はプロセスの形式化とルールの徹底です。\n誤答の「口頭推奨（逆効果）」「専任採用（コスト・意識の問題）」「変更禁止（硬直化）」も、それぞれもっともらしい理由を付けて長文化していますが、本質的な解決策ではありません。",
        "tags": ["第2章", "一般", "シナリオ", "K4"]
    }
]

# ==========================================
# ファイル書き出し
# ==========================================
files = {
    "ch1_general_vol96.json": q1_gen,
    "ch2_finance_vol96.json": q2_fin,
    "ch1_aws_vol96.json": q1_aws,
    "ch3_general_vol96.json": q3_gen,
    "ch2_general_vol96.json": q2_gen
}

for filename, content in files.items():
    file_path = os.path.join(OUTPUT_DIR, filename)
    with open(file_path, 'w', encoding='utf-8') as f:
        json.dump(content, f, ensure_ascii=False, indent=2)
    print(f"Created: {filename}")

print("-" * 30)
print("完了: Vol.96 のファイル生成が完了しました。")