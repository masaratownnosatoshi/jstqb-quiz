:root { --primary:#2b5797; --bg:#f7f7fa; --accent:#ffc000; }
body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP",sans-serif;background:var(--bg);color:#222;}
.container{max-width:980px;margin:0 auto;padding:16px;}
header.app-header{display:flex;align-items:center;justify-content:space-between;gap:12px;}
.top-nav a{margin-right:12px;text-decoration:none;color:var(--primary);} 
header h1{margin:0 0 6px;color:var(--primary);} 
.desc{color:#555;margin:0 0 12px;} 
.hidden{display:none;} 
section{margin-bottom:16px;} 
#controls .row{display:flex;gap:16px;flex-wrap:wrap;margin-bottom:8px;} 
.filters{background:#fff;padding:12px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.06);} 
#meta{display:flex;gap:24px;background:#fff;border-radius:8px;padding:12px;box-shadow:0 2px 6px rgba(0,0,0,.06);} 
#quiz,#results{background:#fff;border-radius:8px;padding:16px;box-shadow:0 2px 6px rgba(0,0,0,.06);} 
#chapter,#level{color:#666;margin-bottom:4px;} 
#questionText{margin-top:4px;} 
form label{display:block;padding:8px;background:#fafafa;border-radius:6px;margin-bottom:8px;border:1px solid #eee;cursor:pointer} 
form input{margin-right:8px;} 
.nav{display:flex;gap:12px;margin-top:12px;} 
button{padding:10px 14px;border:none;border-radius:6px;background:var(--primary);color:#fff;cursor:pointer} 
button.secondary{background:#888;} 
button.danger{background:#d95757;} 
button:disabled{opacity:.5;cursor:not-allowed;} 
#feedback{border-top:1px dashed #ddd;margin-top:12px;padding-top:8px;} 
summary{cursor:pointer;} 
footer{margin-top:24px;color:#777;text-align:center;} 

/* Sticky meta + bottom nav for mobile usability */
#meta{position:sticky;top:0;z-index:100;background:#fff;} 
.nav{position:sticky;bottom:0;z-index:90;background:#fff;border-top:1px solid #eee;padding:12px;} 
canvas{max-width:100%;height:auto;} 

/* Mobile layout */
@media (max-width: 600px) {
  .container { padding: 12px; }
  header.app-header { flex-direction: column; align-items: flex-start; }
  #controls .row { flex-direction: column; align-items: stretch; gap: 10px; }
  input[type="text"], select { width: 100%; padding: 12px; font-size: 1rem; border: 1px solid #ddd; border-radius: 8px; background: #fff; }
  button, .secondary { width: 100%; padding: 12px 14px; font-size: 1rem; border-radius: 10px; }
  form label { padding: 12px; font-size: 1rem; }
  #chapter, #level { font-size: .95rem; }
  header h1 { font-size: 1.3rem; }
}

/* Dark mode */
@media (prefers-color-scheme: dark) {
  :root { --bg:#121212; --primary:#8ab4f8; --accent:#ffd666; }
  body { background: var(--bg); color: #eee; }
  .filters, #quiz, #results, #meta { background: #1d1d1d; box-shadow: none; border: 1px solid #333; }
  form label { background: #222; border-color: #333; }
  .nav { background: #1d1d1d; border-top-color: #333; }
  footer { color: #999; }
}

/* Accessibility focus */
button, summary, label { touch-action: manipulation; }
button:focus-visible, a:focus-visible, summary:focus-visible, label:focus-visible {
  outline: 3px solid rgba(43,87,151,.4);
  outline-offset: 2px;
  border-radius: 8px;
}
